bundle:
  name: nemweb-lab

variables:
  # NEMWEB Lab configuration
  project_name:
    description: "Name of the NEMWEB solution accelerator lab"
    default: "nemweb-lab"

  # Unity Catalog configuration
  catalog:
    description: "Unity Catalog catalog name"
    default: "main"

  schema:
    description: "Unity Catalog schema name"
    default: "nemweb_lab"

  # SQL Warehouse for dashboard queries
  warehouse_id:
    lookup:
      warehouse: "Serverless Starter Warehouse"

  # Environment for deployment paths
  environment:
    description: "Deployment environment (dev, staging, prod)"
    default: "dev"

targets:
  dev:
    default: true
    mode: development

  prod:
    mode: production

resources:
  # NEMWEB Price Dashboard App
  apps:
    nemweb_prices:
      name: "nemweb-prices-${var.environment}"
      description: "Real-time NEM electricity price dashboard"
      source_code_path: "./databricks-nemweb-lab/app"

  # Lab workflow - runs exercises in sequence
  jobs:
    nemweb_lab_workflow:
      name: "${var.project_name} - Lab Exercises [${var.environment}]"
      tasks:
        - task_key: setup_validation
          notebook_task:
            notebook_path: "./databricks-nemweb-lab/notebooks/00_setup_and_validation.py"
            base_parameters:
              catalog: "${var.catalog}"
              schema: "${var.schema}"

        - task_key: custom_datasource
          depends_on:
            - task_key: setup_validation
          notebook_task:
            notebook_path: "./databricks-nemweb-lab/notebooks/01_custom_datasource_exercise.py"

        - task_key: lakeflow_pipeline
          depends_on:
            - task_key: custom_datasource
          notebook_task:
            notebook_path: "./databricks-nemweb-lab/notebooks/02_lakeflow_pipeline_exercise.py"

        - task_key: cluster_sizing
          depends_on:
            - task_key: lakeflow_pipeline
          notebook_task:
            notebook_path: "./databricks-nemweb-lab/notebooks/03a_cluster_sizing_exercise.py"

        - task_key: optimization_comparison
          depends_on:
            - task_key: lakeflow_pipeline
          notebook_task:
            notebook_path: "./databricks-nemweb-lab/notebooks/03b_optimization_comparison.py"

    # Solution workflow for instructors
    nemweb_lab_solutions:
      name: "${var.project_name} - Solutions [${var.environment}]"
      tasks:
        - task_key: setup_validation
          notebook_task:
            notebook_path: "./databricks-nemweb-lab/notebooks/00_setup_and_validation.py"
            base_parameters:
              catalog: "${var.catalog}"
              schema: "${var.schema}"

        - task_key: custom_datasource_solution
          depends_on:
            - task_key: setup_validation
          notebook_task:
            notebook_path: "./databricks-nemweb-lab/solutions/01_custom_datasource_solution.py"

        - task_key: lakeflow_pipeline_solution
          depends_on:
            - task_key: custom_datasource_solution
          notebook_task:
            notebook_path: "./databricks-nemweb-lab/solutions/02_lakeflow_pipeline_solution.py"

# For more options and schema, see: https://docs.databricks.com/aws/en/dev-tools/bundles/settings
